# Plugin Template Structure

When creating a new plugin, follow this structure:

```text
plugins/
  your-plugin/
    Cargo.toml
    build.rs
    src/
      lib.rs
      commands.rs
      desktop.rs
      mobile.rs
      error.rs
      models.rs

    permissions/
      default.toml
      schemas/
        schema.json
      autogenerated/

    guest-js/
      index.ts
    package.json
    rollup.config.js
    tsconfig.json
    api-iife.js

    android/
      build.gradle.kts
      settings.gradle.kts
      proguard-rules.pro
      src/main/
        AndroidManifest.xml
        java/com/plugin/yourplugin/
          YourPlugin.kt

    ios/
      Sources/
        YourPlugin.swift

    README.md
```

## Minimal File Content

### `Cargo.toml`

```toml
[package]
name = "tauri-plugin-your-plugin"
version = "0.1.0"
description = "Brief description"
authors = { workspace = true }
license = { workspace = true }
edition = { workspace = true }
rust-version = { workspace = true }
repository = { workspace = true }
links = "tauri-plugin-your-plugin"

[package.metadata.platforms.support]
windows = { level = "full", notes = "" }
linux = { level = "full", notes = "" }
macos = { level = "full", notes = "" }
android = { level = "full", notes = "" }
ios = { level = "none", notes = "" }

[lib]
crate-type = ["staticlib", "cdylib", "rlib"]

[dependencies]
tauri = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
thiserror = { workspace = true }

[build-dependencies]
tauri-plugin = { workspace = true, features = ["build"] }
```

### `build.rs`

```rust
const COMMANDS: &[&str] = &["your_command"];

fn main() {
    tauri_plugin::Builder::new(COMMANDS)
        .global_api_script_path("./api-iife.js")
        .android_path("android")
        .ios_path("ios")
        .build();
}
```

### `src/lib.rs`

```rust
use tauri::{plugin::TauriPlugin, Runtime};

mod commands;
mod error;
mod models;

#[cfg(desktop)]
mod desktop;
#[cfg(mobile)]
mod mobile;

pub use error::{Error, Result};
pub use models::*;

pub fn init<R: Runtime>() -> TauriPlugin<R> {
    tauri::plugin::Builder::new("your-plugin")
        .invoke_handler(tauri::generate_handler![commands::your_command])
        .build()
}
```

### `package.json`

```json
{
	"name": "@liminal-hq/plugin-your-plugin",
	"version": "0.1.0",
	"license": "Apache-2.0 OR MIT",
	"authors": ["Liminal HQ Contributors"],
	"repository": "https://github.com/liminal-hq/liminal-tauri-plugins",
	"type": "module",
	"types": "./dist-js/index.d.ts",
	"main": "./dist-js/index.cjs",
	"module": "./dist-js/index.js",
	"exports": {
		"types": "./dist-js/index.d.ts",
		"import": "./dist-js/index.js",
		"require": "./dist-js/index.cjs"
	},
	"scripts": {
		"build": "rollup -c",
		"prepare": "pnpm build"
	},
	"files": ["dist-js", "README.md", "LICENSE-MIT", "LICENSE-APACHE"],
	"dependencies": {
		"@tauri-apps/api": "^2.10.0"
	},
	"devDependencies": {
		"@rollup/plugin-typescript": "^11.0.0",
		"rollup": "^4.0.0",
		"tslib": "^2.6.0",
		"typescript": "^5.3.0"
	}
}
```

### `rollup.config.js`

```javascript
import { createConfig } from '../../shared/rollup.config.js';

export default createConfig('your-plugin');
```

### `guest-js/index.ts`

```typescript
import { invoke } from '@tauri-apps/api/core';

/**
 * Your command description.
 */
export async function yourCommand(arg: string): Promise<string> {
	return await invoke<string>('plugin:your-plugin|your_command', { arg });
}
```

### `permissions/default.toml`

```toml
[[permission]]
identifier = "allow-your-command"
description = "Enables the your_command command"
commands.allow = ["your_command"]

[default]
permissions = ["allow-your-command"]
```

### `README.md`

````markdown
# @liminal-hq/plugin-your-plugin

Brief description of what this plugin does.

## Installation

### Rust

```toml
[dependencies]
tauri-plugin-your-plugin = "0.1"
```

### JavaScript

```bash
pnpm add @liminal-hq/plugin-your-plugin
```

## Usage

### Rust

```rust
fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_your_plugin::init())
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### JavaScript

```typescript
import { yourCommand } from '@liminal-hq/plugin-your-plugin';

const result = await yourCommand('arg');
```

## Permissions

This plugin requires these permissions:

- `allow-your-command`: Grants access to `your_command`

## Platform Support

| Platform | Support Level | Notes           |
| -------- | ------------- | --------------- |
| Windows  | Full          |                 |
| Linux    | Full          |                 |
| macOS    | Full          |                 |
| Android  | Full          |                 |
| iOS      | None          | Not implemented |

## Licence

Apache-2.0 OR MIT
````

## Adding to Covector

When creating a new plugin, add both package entries in `.changes/config.json`:

```json
{
	"packages": {
		"your-plugin": {
			"path": "./plugins/your-plugin",
			"manager": "rust"
		},
		"your-plugin-js": {
			"path": "./plugins/your-plugin",
			"manager": "javascript"
		}
	}
}
```
